<?php if(!function_exists('tpl_block_capture')){ require(CORE_DIR.'/include_v5/smartyplugins/block.capture.php'); } if(!function_exists('tpl_modifier_storager')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.storager.php'); } if(!function_exists('tpl_modifier_escape')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.escape.php'); } if(!function_exists('tpl_modifier_cut')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.cut.php'); } if(!function_exists('tpl_modifier_styleset')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.styleset.php'); } if(!function_exists('tpl_function_goodsmenu')){ require(CORE_DIR.'/include_v5/smartyplugins/function.goodsmenu.php'); } $CURRENCY = &$this->system->loadModel('system/cur');  echo $this->_fetch_compile_include($this->_get_resource('user:'.$this->theme.'/'."block/header.html")?('user:'.$this->theme.'/'."block/header.html"):('shop:'."block/header.html"), array());?> <div id="centre"> <div class="def_left"> <?php unset($this->_vars);$setting = array ( 'onSelect' => '0', 'explain' => array ( 0 => '', 1 => '', 2 => '', 3 => '', 4 => '', ), 'pricefrom' => '', 'priceto' => '', 'searchname' => '', 'filter1' => 'pricefrom=&priceto=&searchname=&cat_id[]=_ANY_&brand_id[]=_ANY_&tag[]=_ANY_', 'filter2' => 'pricefrom=&priceto=&searchname=&cat_id[]=_ANY_&brand_id[]=_ANY_&tag[]=_ANY_', 'filter3' => 'pricefrom=&priceto=&searchname=&cat_id[]=_ANY_&brand_id[]=_ANY_&tag[]=_ANY_', 'filter4' => 'pricefrom=&priceto=&searchname=&cat_id[]=_ANY_&brand_id[]=_ANY_&tag[]=_ANY_', 'filter5' => 'pricefrom=&priceto=&searchname=&cat_id[]=_ANY_&brand_id[]=_ANY_&tag[]=_ANY_', 'column' => '1', 'limit' => '4', 'showMore' => 'off', 'showGoodsImg' => 'on', 'max_length' => '35', 'showGoodsName' => 'on', 'showGoodsDesc' => 'on', 'showGoodsMktPrice' => 'on', 'mktPriceText' => '市场价', 'mktPriceSep' => ':', 'color1' => 'default', 'showGoodsPrice' => 'on', 'priceText' => '销售价', 'priceSep' => ':', 'color2' => 'default', 'showGoodsSave' => 'on', 'saveText' => '节省', 'saveSep' => ':', 'color3' => 'default', 'showCount' => 'off', 'countText' => '折扣', 'countSep' => '%', 'color5' => 'default', 'showBuyArea' => 'off', 'goodsImgWidth' => '100', 'goodsImgHeight' => '100', 'restrict' => 'off', 'showTitleImg' => 'off', 'showGoodsInfo' => 'off', 'titleImgSrc' => '', 'titleImgHref' => '', 'titleImgAlt' => '', 'showTitle' => 'off', 'titleDesc' => '', 'columNum' => '1', 'changeEffect' => '1', 'cat_id' => array ( 0 => '_ANY_', 1 => '_ANY_', 2 => '_ANY_', 3 => '_ANY_', 4 => '_ANY_', ), 'brand_id' => array ( 0 => '_ANY_', 1 => '_ANY_', 2 => '_ANY_', 3 => '_ANY_', 4 => '_ANY_', ), 'tag' => array ( 0 => '_ANY_', 1 => '_ANY_', 2 => '_ANY_', 3 => '_ANY_', 4 => '_ANY_', ), 'goods_orderby' => '0', 'goodsImgPosition' => 'left', 'mark_font' => '0', 'member_font' => '0', 'save_font' => '0', 'count_font' => '0', 'titleImgPosition' => 'top', );$this->bundle_vars['setting'] = &$setting;if(!function_exists('widget_goods')){require(PLUGIN_DIR.'/widgets/goods/widget_goods.php');}$this->_vars = array('data'=>widget_goods($setting,$GLOBALS['system']),'widgets_id'=>'102');ob_start();?><style> .itemsWrap{ *display:block; float:left; overflow:hidden; } </style> <input type="hidden" name="goods_num" id="goods_num" value="<?php echo $this->_vars['data']['goods_num']; ?>"> <?php $this->_tag_stack[] = array('tpl_block_capture', array('name' => titleImg)); tpl_block_capture(array('name' => titleImg), null, $this); ob_start(); ?> <div class="titleImg"><a href="<?php echo $this->_env_vars['base_url'],"gallery-{$this->bundle_vars['setting']['id']}",(((is_numeric($this->bundle_vars['setting']['id']) && 'index'==$this->bundle_vars['setting']['view']) || !$this->bundle_vars['setting']['view'])?'':'-'.$this->bundle_vars['setting']['view']),'.html';?>"><img src="" title=""/></a></div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsCat)); tpl_block_capture(array('name' => goodsCat), null, $this); ob_start();  $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsLoop)); tpl_block_capture(array('name' => goodsLoop), null, $this); ob_start();  $this->_env_vars['foreach'][goodslist]=array('total'=>count($this->_vars['data']['goods']),'iteration'=>0);foreach ((array)$this->_vars['data']['goods'] as $this->_vars['key'] => $this->_vars['goods_data']){ $this->_env_vars['foreach'][goodslist]['first'] = ($this->_env_vars['foreach'][goodslist]['iteration']==0); $this->_env_vars['foreach'][goodslist]['iteration']++; $this->_env_vars['foreach'][goodslist]['last'] = ($this->_env_vars['foreach'][goodslist]['iteration']==$this->_env_vars['foreach'][goodslist]['total']);  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsImg)); tpl_block_capture(array('name' => goodsImg), null, $this); ob_start(); ?> <div class="goodsImg" style="overflow:hidden;text-align:center;vertical-align: middle;width:100px;height:100px;"><a href="<?php echo $this->_env_vars['base_url'],"product-{$this->_vars['goods_data']['goods_id']}",(((is_numeric($this->_vars['goods_data']['goods_id']) && 'index'=="index") || !"index")?'':'-'."index"),'.html';?>" target="_blank" title="<?php echo $this->_vars['goods_data']['name']; ?>"><img width="100"height="100" src="<?php echo tpl_modifier_storager(((isset($this->_vars['goods_data']['thumbnail_pic']) && ''!==$this->_vars['goods_data']['thumbnail_pic'])?$this->_vars['goods_data']['thumbnail_pic']:$this->system->getConf('site.default_thumbnail_pic'))); ?>" title="<?php echo $this->_vars['goods_data']['name']; ?>"></a></div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsName)); tpl_block_capture(array('name' => goodsName), null, $this); ob_start(); ?> <h6><a href="<?php echo $this->_env_vars['base_url'],"product-{$this->_vars['goods_data']['goods_id']}",(((is_numeric($this->_vars['goods_data']['goods_id']) && 'index'=="index") || !"index")?'':'-'."index"),'.html';?>" target="_blank" title="<?php echo tpl_modifier_escape($this->_vars['goods_data']['name'],html); ?>"><?php echo tpl_modifier_cut($this->_vars['goods_data']['name'],$this->bundle_vars['setting']['max_length']); ?></a></h6> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsDesc)); tpl_block_capture(array('name' => goodsDesc), null, $this); ob_start(); ?> <ul> <?php $this->_vars["savePC"]=$this->_vars['goods_data']['mktprice']-$this->_vars['goods_data']['price']; ?> <li><span class="mktprice0"></span><span class="mktprice1" style="color:default;">市场价:<?php echo $CURRENCY->changer($this->_vars['goods_data']['mktprice']); ?></span></li> <li><span class="price0">销售价:</span><span class="price1" style="color:default;"><?php echo $CURRENCY->changer($this->_vars['goods_data']['price']); ?></span></li> <?php if( $this->_vars['savePC']>0 && $this->bundle_vars['setting']['showGoodsSave']=="on" ){ ?><li><span class="save0">节省:</span><span class="save1" style="color:default;"><?php echo $CURRENCY->changer($this->_vars['savePC']); ?></span></li><?php }  if( $this->bundle_vars['setting']['showGoodsInfo']=="on" && $this->_vars['goods_data']['brief'] ){ ?><li><span class="info0">简介：<?php echo $this->_vars['goods_data']['brief']; ?></span></li><?php } ?> </ul> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?> <div class="itemsWrap <?php if( $this->bundle_vars['setting']['column'] > 1 &&($this->_env_vars['foreach']['goodslist']['iteration'] % ((isset($this->bundle_vars['setting']['column']) && ''!==$this->bundle_vars['setting']['column'])?$this->bundle_vars['setting']['column']:4)) == 0 ){ ?>last<?php } ?>" product="<?php echo $this->_vars['goods_data']['goods_id']; ?>" style="width:<?php echo (floor(99/('1')));?>%;"> <div class="item"> <table width="100%" border="0" cellspacing="0" cellpadding="0"> <tr> <td><?php echo $this->_env_vars['capture']['goodsImg']; ?></td> <td class="goodsDesc"> <?php echo $this->_env_vars['capture']['goodsName'];  echo $this->_env_vars['capture']['goodsDesc']; ?> </td> </tr> </table> </div> </div> <?php if( $this->bundle_vars['setting']['column']!=1 &&($this->_env_vars['foreach']['goodslist']['iteration'] % ((isset($this->bundle_vars['setting']['column']) && ''!==$this->bundle_vars['setting']['column'])?$this->bundle_vars['setting']['column']:4)) == 0 ){ ?> <div class="clear"></div> <?php }  } unset($this->_env_vars['foreach'][goodslist]); ?> <div class="clear"></div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?> <div class="GoodsListWrap"> <div class="GoodsList"> <?php echo $this->_env_vars['capture']['goodsCat'];  echo $this->_env_vars['capture']['goodsLoop']; ?> </div> <?php if( $this->bundle_vars['setting']['showMore'] == "on" && $this->_vars['data']['link'] ){ ?> <div class="more clearfix"><a href="<?php echo $this->_vars['data']['link']; ?>">更多...</a></div> <?php } ?> </div> <?php $body = str_replace('%THEME%','{ENV_theme_dir}',ob_get_contents());ob_end_clean();$this->_vars = array('body'=>&$body,'title'=>'推荐商品','widgets_id'=>'','widgets_classname'=>'');?><div class="border9" id="<?php echo $this->_vars['widgets_id']; ?>"> <div class="border-top"><h3><?php echo $this->_vars['title']; ?></h3></div> <div class="border-body"><?php echo $this->_vars['body']; ?></div> </div><?php $setting=null;$this->_vars = &$this->pagedata;?> <div class="clear"></div> <?php unset($this->_vars);$setting = array ( 'max' => '3', );$this->bundle_vars['setting'] = &$setting;if(!function_exists('widget_hst')){require(PLUGIN_DIR.'/widgets/hst/widget_hst.php');}$this->_vars = array('data'=>widget_hst($setting,$GLOBALS['system']),'widgets_id'=>'103');ob_start();?><div class="GoodsBrowsed" id="box_<?php echo $this->_vars['widgets_id']; ?>" > </div> <script>
withBroswerStore(function(broswerStore){
var box=$('box_<?php echo $this->_vars['widgets_id']; ?>');;
broswerStore.get('history',function(v){
v=JSON.decode(v);
if(!v||!v.length)return;
      var html='';
      var template = '<div class="clearfix">';
          template+='<div class="span-2 goodpic">';
          template+= '<a href="<?php echo $this->_env_vars['base_url'],"product-{goodsId}",(((is_numeric('{goodsId}') && 'index'=='index')  || !'index')?'':'-'.'index'),'.html';?>" target="_blank" title="{goodsName}" inner_img="{goodsImg}" gid="{goodsId}">';
          template+= '</a>';
          template+= '</div><div class="prepend-2 goodsName">';
          template+= '<div class="view-time">{viewTime}</div>';
          template+='<a href="<?php echo $this->_env_vars['base_url'],"product-{goodsId}",(((is_numeric('{goodsId}') && 'index'=='index')  || !'index')?'':'-'.'index'),'.html';?>" target="_blank" title="{goodsName}">{goodsName}</a></div></div><hr/>';
      
      var max=Math.min(v.length,3);
      if(v.length>1)
      v.reverse();
      
      v.each(function(goods,index){
      var vt = ($time() - goods['viewTime']);
          vt = Math.round(vt/(60*1000))+'分钟前浏览过:';
      if(vt.toInt()>=60){
        vt = Math.round(vt.toInt()/60)+'小时前浏览过:';
        if(vt.toInt()>23){
           vt = Math.round(vt.toInt()/24)+'天前浏览过:';
           if(vt.toInt()>3){
             vt = new Date(goods['viewTime']).toLocaleString()+'浏览过:';
           }
        } 
       };
       if(!!!vt.toInt()){vt='刚才浏览了:'}
       goods['viewTime'] = vt;
       if(index<max)
       html += template.substitute(goods);
      });
      
      $('box_<?php echo $this->_vars['widgets_id']; ?>').set('html',html);
      
    $ES('.goodpic',box).each(function(i){
          var imga=$E('a',i);
          var imgsrc=imga.get('inner_img');
          if(!imgsrc){
            imgsrc = "<?php echo $this->_vars['data']['default_thumbnail_pic']; ?>";
          }
          imga.setText('loading...');
       new Asset.image(imgsrc,{onload:function(){
                var img=$(this);
                if(img.$e)return;
                img.zoomImg(70,70);
                img.inject(imga.empty());
                img.$e=true;
            },onerror:function(){
            
                imga.setText('update...');
                var gid = imga.get('gid');
                 new Request.JSON({method:'get',url:"<?php echo $this->_env_vars['base_url'],"product",(((is_numeric('product') && 'index'=='picsJson')  || !'picsJson')?'':'-'.'picsJson'),'.html';?>",onComplete:function(data){
                     new Asset.image(data[0]['thumbnail_pic'],{onload:function(){
                        var img=$(this);
                        if(img.$e)return;
                        img.zoomImg(70,70);
                        img.inject(imga.empty());
                        img.$e=true;
                      },onerror:function(){
                         imga.remove();
                      }});
                      
                      v.map(function(goods,index){
                           if(index<max&&goods['goodsId']==gid){
                                return goods['goodsImg']='';
                           }else{
                                return goods['goodsImg']=data[0]['thumbnail_pic'];
                           }
                      });
                    broswerStore.set('history',v);
                 }}).get($H({'gids':gid}));
                
            
            }
        });          
      });

});


});
</script> <div class="textright"> <a class="lnk clearAll" onclick="if(broswerStore){broswerStore.remove('history');$('box_<?php echo $this->_vars['widgets_id']; ?>').empty()}">清除列表</a> | <a class="lnk viewAll" href="<?php echo $this->_env_vars['base_url'],"tools",(((is_numeric("tools") && 'index'=="history") || !"history")?'':'-'."history"),'.html';?>">查看所有</a><span>&nbsp;&nbsp;</span> </div> <?php $body = str_replace('%THEME%','{ENV_theme_dir}',ob_get_contents());ob_end_clean();$this->_vars = array('body'=>&$body,'title'=>'浏览过的商品','widgets_id'=>'','widgets_classname'=>'');?><div class="border4" id="<?php echo $this->_vars['widgets_id']; ?>"> <div class="border-top"><h3><?php echo $this->_vars['title']; ?></h3></div> <div class="border-body"><?php echo $this->_vars['body']; ?></div> </div><?php $setting=null;$this->_vars = &$this->pagedata;?> </div> <div class="def_right"> <?php unset($this->_vars);$setting = array ( );$this->bundle_vars['setting'] = &$setting;if(!function_exists('widget_nav')){require(PLUGIN_DIR.'/widgets/nav/widget_nav.php');}$this->_vars = array('data'=>widget_nav($setting,$GLOBALS['system']),'widgets_id'=>'104');ob_start();?><div class="Navigation">您当前的位置： <?php if( $this->_vars['setting']['begin'] ){ ?> <span class="begin"><?php echo $this->_vars['setting']['begin']; ?></span> <?php }  $this->_env_vars['foreach']["nav"]=array('total'=>count($this->_vars['data']),'iteration'=>0);foreach ((array)$this->_vars['data'] as $this->_vars['item']){ $this->_env_vars['foreach']["nav"]['first'] = ($this->_env_vars['foreach']["nav"]['iteration']==0); $this->_env_vars['foreach']["nav"]['iteration']++; $this->_env_vars['foreach']["nav"]['last'] = ($this->_env_vars['foreach']["nav"]['iteration']==$this->_env_vars['foreach']["nav"]['total']);  if( $this->_vars['item']['title'] && $this->_vars['item']['link'] ){  if( $this->_env_vars['foreach']['nav']['last'] ){ ?> <span class="now"><?php echo $this->_vars['item']['title']; ?></span> <?php }else{ ?> <span><a href="<?php echo $this->_vars['item']['link']; ?>" alt="<?php echo $this->_vars['item']['tips']; ?>" title="<?php echo $this->_vars['item']['tips']; ?>"><?php echo $this->_vars['item']['title']; ?></a></span> <?php if( $this->_vars['setting']['split'] ){  echo $this->_vars['setting']['split'];  }else{ ?><span>&raquo;</span><?php } ?></td> <?php }  }  } unset($this->_env_vars['foreach']["nav"]);  if( $this->_vars['setting']['end'] ){ ?> <span class="end"><?php echo $this->_vars['setting']['end']; ?></span> <?php } ?> </div><?php $body = str_replace('%THEME%','{ENV_theme_dir}',ob_get_contents());ob_end_clean();echo '<div id="104">',$body,'</div>';unset($body);$setting=null;$this->_vars = &$this->pagedata;?> <div class="clear"></div> <?php echo $this->_fetch_compile_include($this->template_exists('user:'.$this->theme.'/view/'.$this->_vars['_MAIN_'])?'user:'.$this->theme.'/view/'.$this->_vars['_MAIN_']:'shop:'.$this->_vars['_MAIN_'], array());?></div> </div> <?php echo $this->_fetch_compile_include($this->_get_resource('user:'.$this->theme.'/'."block/footer.html")?('user:'.$this->theme.'/'."block/footer.html"):('shop:'."block/footer.html"), array());?>